TICKET: 1160609

### INFORMAÇÕES GERAIS
* Data: 11/09/2025
* Status: Resolvido
* Título: Link de Pagamento Sponte Pay - Link com Pix Expirado Sendo Apresentado como Processado, Impossibilitando o Cancelamento

### PROBLEMA
* Local: Financeiro → Integração Sponte Pay → Link de Pagamento Sponte Pay (antigo Faturas Sponte Pay)

Uma parcela de aluno (ex: "Edson Arantes Silva do Nascimento", venc. 11/09/2025) fica travada no `Contas a Receber` com o status "Em processamento".

Isso ocorre porque a parcela está vinculada a um "Link de Pagamento Sponte Pay" (Fatura Sponte Pay) que, por sua vez, está associado a um PIX que já foi expirado ou cancelado.

Sintomas no menu `Link de Pagamento Sponte Pay`:
* O link de pagamento (fatura) NÃO aparece na primeira aba (Faturas a processar).
* O link de pagamento (fatura) aparece incorretamente na segunda aba (Faturas processadas).

O problema impede o usuário de cancelar ou gerenciar a parcela, pois ela está "presa" a um link de pagamento que não pode ser processado.

### SOLUÇÃO
A correção foi aplicada diretamente na rotina de cancelamento do Pix Sponte Pay.

Agora, no momento em que um Pix é cancelado, o sistema automaticamente **remove o vínculo** dele com o Link de Pagamento (Fatura Sponte Pay). Isso impede que o link fique "órfão" e trave a parcela.

Além da correção permanente, um script SQL foi executado retroativamente para liberar as parcelas que ficaram presas antes dessa correção.

SCRIPT DE CORREÇÃO (Retroativo):

insert into log select getdate(), 'FaturasSpontePay', faturaspontepayid, 3,'Removido por cancelamento de pix conforme ticket 1160609',0,ce from faturasspontepay where planostoneid in(select planostoneid from pixspontepaycancelados where datacancelamento > '2025-09-09')

delete from faturasspontepaydetalhes where faturaspontepayid in(select faturaspontepayid from faturasspontepay where planostoneid in(select planostoneid from pixspontepaycancelados where datacancelamento > '2025-09-09'))

delete from faturasspontepay where planostoneid in(select planostoneid from pixspontepaycancelados where datacancelamento > '2025-09-09')